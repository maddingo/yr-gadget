<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="yr.no weather" >
  	<Require feature="setprefs" /> 
  </ModulePrefs>
  <UserPref
  	name="place"
  	required="true"/>
  <Content type="html">
    <![CDATA[
    <div id="weather"></div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"> </script>
<script type="text/javascript">
function makeDomRequest() {
	var params = {};  
    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
    var url = "http://www.yr.no/sted/Hellas/Attika/P%C3%B3ros/varsel.xml";  
    gadgets.io.makeRequest(url, response, params);
}

function response(xml) {
}

var urlParams = {};
(function () {
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        //query  = window.location.search.substring(1);
        query = document.getElementById("weather").ownerDocument.location;

    while (match = search.exec(query)) {
    	var key = decode(match[1]);
    	var val = decode(match[2]);
       urlParams[decode(match[1])] = decode(match[2]);
       $(#weather).append(key + ": " + val + "<br/>");
    }
})();

//document.getElementById("weather").innerHTML = document.getElementById("weather").ownerDocument.location;
$("#weather").append(urlParams["url"]);
$("#weather").append("<br/>");

// gadgets.util.registerOnLoadHandler(makeDOMRequest);
</script>
    ]]>
  </Content>
</Module>
