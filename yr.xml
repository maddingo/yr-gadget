<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="yr.no weather" >
  	<Require feature="setprefs" /> 
  </ModulePrefs>
  <UserPref
  	name="place"
  	required="true"/>
  <Content type="html">
    <![CDATA[
    <div id="weather"></div>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"> </script>
<script type="text/javascript">

// Parse URL Queries
function url_query( srcUrl, query ) {
	query = query.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
	var expr = "[\\?&]"+query+"=([^&#]*)";
	var regex = new RegExp( expr );
	var results = regex.exec( srcUrl );
	if( results !== null ) {
		return results[1];
		return decodeURIComponent(results[1].replace(/\+/g, " "));
	} else {
		return false;
	}
}
 
function makeDomRequest() {
	var params = {};  
    params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
	var url_param = url_query(document.getElementById("weather").ownerDocument.location, 'url');
	if( url_param ) {
		url_param = decodeURIComponent("http://www.yr.no/"+url_param.replace(/[^\?]*\?/, ""));
		
		$("#weather").append("<a href=\""+url_param+"\">v√¶ret fra yr.no</a><br/>");
		//gadgets.io.makeRequest(url_param, response, params);
	}
	
}

function response(xml) {
}


gadgets.util.registerOnLoadHandler(makeDomRequest);
</script>
    ]]>
  </Content>
</Module>
